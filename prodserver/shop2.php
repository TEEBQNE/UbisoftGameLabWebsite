<!-- Shop tab portion of the stream page -->

<!DOCTYPE html>
<html>
<body>
<div class ="wrapper">
<div id = "theText">
<div id = "headerText">Game Purchase Menu</div>
<!--<div id = "headerText2">Purchase events or items to change gameplay</div>-->
</div>
<!--<div id = "line"></div>-->
<!-- Could have been loaded dynamically using javascript but decided against it to prevent
	 lock up on smaller devices (phones)
-->
<ul id="myUL">
	<div class = "container">
	<li>
			<div id = "emoteImg">
			<div class = "contributed" id = "raised1"><p>$0k</p></div>
			<div class = "priceTag" id = "itemPrice1"><p>$30k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item1" type="image" src="WebsiteArt/BuyLaser.png"" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup1">&nbsp<span></span></div>
  			</div>
  			<div id="itemId1" class="emoteId"><p><span>Laser Enemy</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised2"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice2"><p>$160k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item2" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup2">&nbsp<span></span></div>
  			</div>
  			<div id="itemId2" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised3"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice3"><p>$200k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item3" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup3">&nbsp<span></span></div>
  			</div>
  			<div id="itemId3" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised4"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice4"><p>$45k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item4" type="image" src="WebsiteArt/BuyElite.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup4">&nbsp<span></span></div>
  			</div>
  			<div id="itemId4" class="emoteId"><p><span>Elite Enemy</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised5"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice5"><p>$240k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item5" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup5">&nbsp<span></span></div>
  			</div>
  			<div id="itemId5" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised6"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice6"><p>$420k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item6" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup6">&nbsp<span></span></div>
  			</div>
  			<div id="itemId6" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised7"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice7"><p>$60k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item7" type="image" src="WebsiteArt/BuyBomb.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup7">&nbsp<span></span></div>
  			</div>
  			<div id="itemId7" class="emoteId"><p><span>Bomb</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised8"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice8"><p>$550k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item8" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup8">&nbsp<span></span></div>
  			</div>
  			<div id="itemId8" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised9"><p>$0k</p></div>
  			<div style="display: none" class = "priceTag" id = "itemPrice9"><p>$900k</p></div>
  			<div class = "userPicture"><input disabled onclick="clickItemButton(this.id)"id ="item9" type="image" src="WebsiteArt/BuyLock.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup9">&nbsp<span></span></div>
  			</div>
  			<div id="itemId9" class="emoteId"><p><span>Coming Soon</span></p></div>
	</li>
	</div>
</ul>

<div id = "recentItemPurchase"></div>

<button onclick="singlePressBuyItem()" id = "interactButton">Contribute 5k</button>
<--<img  class="map" src="WebsiteArt/areaMapButton.png" usemap="#map" alt="Contribute 5k" ><p id = "buttonText">Contribute 5k</p></img>

<map id="map_ID" name="map">
        <area onclick="singlePressBuyItem()" class="buyingObj" shape="poly" coords="12, 4, 1717, 4, 1205, 262, 526, 262, 12, 4"  href=""/>
-->
</div>


<script>
var itemSelected = null;

var pressInterval;
var isHolding = false;
var firstItem = true;

// function to determine press down events. makes buying items easier/faster
$("#interactButton").on('touchstart mousedown',function() {
   isHolding = true;
  pressInterval = setInterval(buyItem, 500);
}).on('touchend mouseup',function() {
  clearInterval(pressInterval);
  isHolding = false;
});

function clickItemButton(info)
{
	// if an item is already set, unset it
	if(itemSelected != null)
		itemSelected.classList.remove('thePicture');

	// set the new item clicked
	itemSelected = document.getElementById(info);
	itemSelected.classList.add('thePicture');
}

// increase the contribution for the specified shop item and send data to server
function incContribution(theID)
{
var e1 = $('#fillup' + theID[5] + ' span');
var e2 = $('#fillup' + theID[5]);
var raised = $('#raised' + theID[5]);

	$(function(){
		// amount they contribute
		var moneyAdded = 5;
		
		// grab items price
		var totalCost = $('#itemPrice' + theID[5]).text();
		
		// remove the dolar sign and K from it while converting it to an int for calculations
		totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
		var toRaised = raised.text();
		toRaised = parseInt(toRaised.replace(/\D+/g, ''), 10);
		toRaised += moneyAdded;
		var toIncrease = (toRaised / totalCost) * 100;
		
		// update the text in html
		raised.text('$' + toRaised + 'k');
		
		// update the height of the circle by % height
		e1.css({'height': toIncrease + '%'});  
		
		// sends the current total cost
		// current total is maintained by the server
		$.contributeToShopItem(totalCost, theID[5]);
	
		// check if it has hit 100% of the shape
		if(toIncrease >= 100)
		{
			// reset everything (play some music or have an 'event'
			raised.text('$' + 0 + 'k');
			e1.css('height', 0); 
			writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + theID[5] + ' span').text(), 1);
		}
	});
}

// locally updates contribution data for the shop
function updateShopButtonData(buttonID, buttonTotal, buttonCurrent)
{
	var e1 = $('#fillup' + buttonID + ' span');
	var e2 = $('#fillup' + buttonID);
	var raised = $('#raised' + buttonID);
	
	// remove the dolar sign and K from it while converting it to an int for calculations
	//totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
	
	var toIncrease = (parseInt(buttonCurrent) / parseInt(buttonTotal)) * 100;

	// update the text in html
	raised.text('$' + buttonCurrent + 'k');

	// update the height of the circle by % height
	e1.css({'height': toIncrease + '%'});  

	// check if it has hit 100% of the shape
	if(toIncrease >= 100)
	{
		// reset everything (play some music or have an 'event'
		raised.text('$' + 0 + 'k');
		e1.css('height', 0); 
		writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + buttonID + ' span').text(), 1);
	}
}

// updates shop button data when received from the server
function serverUpdateContribution(buttonID, newAmount)
{
	var e1 = $('#fillup' + buttonID + ' span');
	var e2 = $('#fillup' + buttonID);
	var raised = $('#raised' + buttonID);
	var totalCost = $('#itemPrice' + buttonID).text();
	
	// remove the dolar sign and K from it while converting it to an int for calculations
	totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
	
	var toIncrease = (parseInt(newAmount) / totalCost) * 100;

	// update the text in html
	raised.text('$' + newAmount + 'k');

	// update the height of the circle by % height
	e1.css({'height': toIncrease + '%'});  

	// check if it has hit 100% of the shape
	if(toIncrease >= 100)
	{
		// reset everything (play some music or have an 'event'
		raised.text('$' + 0 + 'k');
		e1.css('height', 0); 
		writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + buttonID + ' span').text(), 1);
	}
}

// posts new money after purchase is made to server
function updateMoney(currentMoney, moneyElem, price)
{
	currentMoney-=5;
	$.ajax({
		type: 'POST',
        url: 'updateMoney.php',
        data: 
        {
        	updatedMoney:currentMoney
        },
        success: function(data) {
			moneyElem.text("$ " + currentMoney + "k");
			incContribution('"' + itemSelected.id + '"');
			moneyAnimation(5, false);
		}
	});
}

// used to check money every purchase to prevent cheating, but for
// performance took it out for the prototype 
function retrieveMoney()
{
	/*$.ajax({
        url: 'getMoney.php',
        dataType: 'text',
        success: function(data) {
			// pulls information, converts ints to ints, does arithmetic calculation
			// to test if they can buy emote
			var moneyElem = $('#money');
			var currentMoney = parseInt(data);
			moneyElem.text();

			var name = ($('#item' + itemSelected.id[4])).text();
			var price = ($('#itemPrice' + itemSelected.id[4])).text();

			price = parseInt(price.replace(/\D+/g, ''), 10);

			if(price > currentMoney)
			{
				itemPurchaseText.textContent = "You do not have enough to purchase " + name + ". It costs: $" + price + "k and you only have: $" + currentMoney + "k.";
			}
			else
			{
				// update money on mysql table and in front end
				updateMoney(currentMoney, moneyElem, price);
			}
        }
    });*/
    
    	var moneyElem = $('#money');
		var currentMoney = moneyElem.text();
		currentMoney = parseInt(currentMoney.replace(/\D+/g, ''), 10);

		var name = ($('#item' + itemSelected.id[4])).text();
		var price = ($('#itemPrice' + itemSelected.id[4])).text();

		price = parseInt(price.replace(/\D+/g, ''), 10);

		// hard-coding price as 5 as designers wanted
		if(5 > currentMoney)
		{
			writeNotificationToScreen("You do not have enough to purchase " + name + ". It costs: $" + 5 + "k and you only have: $" + currentMoney + "k.", 0);
		}
		else
		{
			// update money on mysql table and in front end
		updateMoney(currentMoney, moneyElem, price);
		}
}

// determines if it should buy the item on hold or click
function buyItem()
{
	if(!isHolding)
	{
		return;
	}
	else if(itemSelected != null)
	{
		// call to ajax as it is async
		retrieveMoney();
	}
	else
	{
		// print error message if user has nothing selected
		writeNotificationToScreen("You need to select an item to buy before buying something!", 0);
	}
}

// single press purchase 
function singlePressBuyItem()
{
        if(itemSelected != null)
        {
                // call to ajax as it is async
                retrieveMoney();
        }
        else
        {
                writeNotificationToScreen("You need to select an item to buy before buying something!", 0);
        }
}


</script>
</body>
</html>
