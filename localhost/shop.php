<!DOCTYPE html>
<html>
<body>
<div class ="wrapper">
<div id = "theText">
<div id = "headerText">Game Purchase Menu</div>
<div id = "headerText2">Purchase events or items to change gameplay</div>
</div>
<div id = "line"></div>
<ul id="myUL">
	<div class = "container">
	<li>
			<div id = "emoteImg">
			<div class = "contributed" id = "raised1"><p>$0k</p></div>
			<div class = "priceTag" id = "itemPrice1"><p>$140k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item1" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup1">&nbsp<span></span></div>
  			</div>
  			<div id="itemId1" class="emoteId"><p><span>Sleep</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised2"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice2"><p>$150k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item2" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup2">&nbsp<span></span></div>
  			</div>
  			<div id="itemId2" class="emoteId"><p><span>Poutine</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised3"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice3"><p>$200k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item3" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup3">&nbsp<span></span></div>
  			</div>
  			<div id="itemId3" class="emoteId"><p><span>No More Graphics</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised4"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice4"><p>$250k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item4" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup4">&nbsp<span></span></div>
  			</div>
  			<div id="itemId4" class="emoteId"><p><span>Sleep Again</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised5"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice5"><p>$300k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item5" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup5">&nbsp<span></span></div>
  			</div>
  			<div id="itemId5" class="emoteId"><p><span>Functioning Website</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised6"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice6"><p>$420k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item6" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup6">&nbsp<span></span></div>
  			</div>
  			<div id="itemId6" class="emoteId"><p><span>Web Servers</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised7"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice7"><p>$500k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item7" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup7">&nbsp<span></span></div>
  			</div>
  			<div id="itemId7" class="emoteId"><p><span>Actually making this work</span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised8"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice8"><p>$550k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item8" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup8">&nbsp<span></span></div>
  			</div>
  			<div id="itemId8" class="emoteId"><p><span><span>RandomLonger</br>TextThing</span></span></p></div>
	</li>
	</div>
	<div class = "container">
	<li>
  			<div id = "emoteImg">
  			<div class = "contributed" id = "raised9"><p>$0k</p></div>
  			<div class = "priceTag" id = "itemPrice9"><p>$1000k</p></div>
  			<div class = "userPicture"><input onclick="clickItemButton(this.id)"id ="item9" type="image" src="https://www.colorhexa.com/013220.png" name="message" class="btTxt submit"/></div>
  			<div class="fillup" id="fillup9">&nbsp<span></span></div>
  			</div>
  			<div id="itemId9" class="emoteId"><p><span>Ubisoft Internship</span></p></div>
	</li>
	</div>
</ul>

<div id = "recentItemPurchase"></div>

<button onclick="buyItem()"id = "interactButton">Contribute 5k</button>
</div>


<script>
var itemSelected = null;

var itemPurchaseText = document.getElementById('notificationText');

function clickItemButton(info)
{
	// detects when an item button is clicked
	if(itemSelected != null)
		itemSelected.classList.remove('thePicture');

	itemSelected = document.getElementById(info);
	itemSelected.classList.add('thePicture');
}

function incContribution(theID)
{
var e1 = $('#fillup' + theID[5] + ' span');
var e2 = $('#fillup' + theID[5]);
var raised = $('#raised' + theID[5]);

	$(function(){
		// amount they contribute
		var moneyAdded = 5;
		
		// grab items price
		var totalCost = $('#itemPrice' + theID[5]).text();
		
		// remove the dolar sign and K from it while converting it to an int for calculations
		totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
		var toRaised = raised.text();
		toRaised = parseInt(toRaised.replace(/\D+/g, ''), 10);
		toRaised += moneyAdded;
		var toIncrease = (toRaised / totalCost) * 100;
		
		// update the text in html
		raised.text('$' + toRaised + 'k');
		
		// update the height of the circle by % height
		e1.css({'height': toIncrease + '%'});  
		
		// sends the current total cost
		// current total is maintained by the server
		$.contributeToShopItem(totalCost, theID[5]);
	
		// check if it has hit 100% of the shape
		if(toIncrease >= 100)
		{
			// reset everything (play some music or have an 'event'
			raised.text('$' + 0 + 'k');
			e1.css('height', 0); 
			writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + theID[5] + ' span').text());
		}
	});
}

function updateShopButtonData(buttonID, buttonTotal, buttonCurrent)
{
	console.log("TEST");
	var e1 = $('#fillup' + buttonID + ' span');
	var e2 = $('#fillup' + buttonID);
	var raised = $('#raised' + buttonID);
	
	// remove the dolar sign and K from it while converting it to an int for calculations
	//totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
	
	var toIncrease = (parseInt(buttonCurrent) / parseInt(buttonTotal)) * 100;

	// update the text in html
	raised.text('$' + buttonCurrent + 'k');

	// update the height of the circle by % height
	e1.css({'height': toIncrease + '%'});  

	// check if it has hit 100% of the shape
	if(toIncrease >= 100)
	{
		// reset everything (play some music or have an 'event'
		raised.text('$' + 0 + 'k');
		e1.css('height', 0); 
		//alert("Congrats you pooled enough money to buy a/an " + $('#itemId' + buttonID + ' span').text());
		writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + buttonID + ' span').text());
	}
}

function serverUpdateContribution(buttonID, newAmount)
{
	var e1 = $('#fillup' + buttonID + ' span');
	var e2 = $('#fillup' + buttonID);
	var raised = $('#raised' + buttonID);
	var totalCost = $('#itemPrice' + buttonID).text();
	
	// remove the dolar sign and K from it while converting it to an int for calculations
	totalCost = parseInt(totalCost.replace(/\D+/g, ''), 10);
	
	var toIncrease = (parseInt(newAmount) / totalCost) * 100;

	// update the text in html
	raised.text('$' + newAmount + 'k');

	// update the height of the circle by % height
	e1.css({'height': toIncrease + '%'});  

	// check if it has hit 100% of the shape
	if(toIncrease >= 100)
	{
		// reset everything (play some music or have an 'event'
		raised.text('$' + 0 + 'k');
		e1.css('height', 0); 
		writeNotificationToScreen("Congrats you pooled enough money to buy a/an " + $('#itemId' + buttonID + ' span').text());
	}
}

function updateMoney(currentMoney, moneyElem, price)
{
	currentMoney-=price;
	$.ajax({
		type: 'POST',
        url: 'updateMoney.php',
        data: 
        {
        	updatedMoney:currentMoney
        },
        success: function(data) {
			moneyElem.text("$ " + currentMoney + "k");
			incContribution('"' + itemSelected.id + '"');
			moneyAnimation(price, false);
		}
	});
}

function retrieveMoney()
{
	/*$.ajax({
        url: 'getMoney.php',
        dataType: 'text',
        success: function(data) {
			// pulls information, converts ints to ints, does arithmetic calculation
			// to test if they can buy emote
			var moneyElem = $('#money');
			var currentMoney = parseInt(data);
			moneyElem.text();

			var name = ($('#item' + itemSelected.id[4])).text();
			var price = ($('#itemPrice' + itemSelected.id[4])).text();

			price = parseInt(price.replace(/\D+/g, ''), 10);

			if(price > currentMoney)
			{
				itemPurchaseText.textContent = "You do not have enough to purchase " + name + ". It costs: $" + price + "k and you only have: $" + currentMoney + "k.";
			}
			else
			{
				// update money on mysql table and in front end
				updateMoney(currentMoney, moneyElem, price);
			}
        }
    });*/
    
    	var moneyElem = $('#money');
    	//console.log(moneyElem.text());
		var currentMoney = moneyElem.text();
		currentMoney = parseInt(currentMoney.replace(/\D+/g, ''), 10);
		moneyElem.text();

		var name = ($('#item' + itemSelected.id[4])).text();
		var price = ($('#itemPrice' + itemSelected.id[4])).text();

		price = parseInt(price.replace(/\D+/g, ''), 10);

		if(price > currentMoney)
		{
			writeNotificationToScreen("You do not have enough to purchase " + name + ". It costs: $" + price + "k and you only have: $" + currentMoney + "k.");
		}
		else
		{
			// update money on mysql table and in front end
			updateMoney(currentMoney, moneyElem, price);
		}
}

function buyItem()
{
	if(itemSelected != null)
	{
		// call to ajax as it is async
		retrieveMoney();
	}
	else
	{
		writeNotificationToScreen("You need to select an item to buy before buying something!");
	}
}

</script>
</body>
</html>